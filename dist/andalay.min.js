angular.module("Andalay",["underscore"]).factory("Andalay",["$http","$q","$parse","_",function(a,b,c,d){"use strict";var e={};e.Model=function(a){var b=a||{};b=d.defaults({},b,d.result(this,"defaults")),this.cid=d.uniqueId("c"),b&&d.extend(this,b)},e.Model.prototype={idAttribute:"id",defaults:{},initialize:function(){},toJSON:function(){var a=angular.copy(this);return delete a.collection,a}},e.Collection=function(){this.initialize.apply(this,arguments)},e.Collection.prototype={model:e.Model,models:[],initialize:function(){},addOne:function(a,b){b=b||{};var c;if(d.isArray(a))throw new Error("The object to add must be an object. Array given");if(!d.isObject(a))throw new Error('Cannot add "'+a+'" to the collection. You must specify an object to add');c=void 0!==b.at?b.at:this.models.length;var e=this.get(a);return this.exists(a)?angular.extend(e,a):(e=this._prepareModel(a),this._addReference(e),this.models.splice(c,0,e),this.length+=1),e},addMany:function(a,b){if(b=b||{},!d.isArray(a))throw new Error("Cannot add "+a+", models must be an array of objects");for(var c=[],e=0;e<a.length;e++){var f=a[e];c.push(this.addOne(f,b))}return c},reset:function(a){this._reset(),a&&this.addMany(a)},get:function(a){return null==a?void 0:this._index[a]||this._index[this.modelId(a)]||this._index[a.cid]},exists:function(a){return!d.isUndefined(this.get(a))},updateMany:function(a){return this.addMany(a)},update:function(a){return this.addOne(a)},remove:function(a){var b=this.get(a);if(null==b)return null;this._removeReference(b);var c=d.indexOf(this.models,b);return this.models.splice(c,1),this.length--,b},removeAll:function(){return this.reset(),this},modelId:function(a){return a[this.model.prototype.idAttribute||"id"]},last:function(){return this.models[this.length-1]},at:function(a){return this.models[a]},size:function(){return this.models.length},all:function(){return this.models},_reset:function(){this.length=0,this.models=[],this._index={}},_prepareModel:function(a){var b=a;return b=a instanceof e.Model?a:new this.model(a),b.collection=this,b},_addReference:function(a){this._index[a.cid]=a;var b=this.modelId(a);null!=b&&(this._index[b]=a)},_removeReference:function(a){delete this._index[a.cid];var b=this.modelId(a);null!=b&&delete this._index[b]},toJSON:function(){for(var a=[],b=this.models.length-1;b>=0;b--){var c=this.at(b);c&&(a[b]=c.toJSON())}return a}};var f=["forEach","find"];d.each(f,function(a){d[a]&&(e.Collection.prototype[a]=function(){var b=[].slice.call(arguments);return b.unshift(this.models),d[a].apply(d,b)})});var g=function(a,b){var c,d=this;c=a&&"function"==typeof a.$constructor?a.$constructor:function(){return d.apply(this,arguments)},angular.extend(c,d,b);var e=function(){this.$constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&angular.extend(c.prototype,a),c.__super__=d.prototype,c};return e.Model.extend=e.Collection.extend=g,e}]);